{"version":3,"file":"test-servers.js","names":["path","fs","express","cors","GraphQLServer","startSignalingServerSimplePeer","startRemoteStorageServer","blobToBase64String","fileURLToPath","__filename","import","meta","url","__dirname","dirname","TEST_STATIC_FILE_SERVER_PORT","startTestServers","staticFilesPath","join","console","log","spawn","port","app","use","get","_req","res","send","static","req","filename","params","filePath","buffer","readFileSync","blob","Blob","base64String","set","listen"],"sources":["../../test/helper/test-servers.ts"],"sourcesContent":["import path from 'node:path';\r\nimport fs from 'node:fs';\r\nimport express from 'express';\r\nimport cors from 'cors';\r\n\r\nimport * as GraphQLServer from './graphql-server.ts';\r\nimport { startSignalingServerSimplePeer } from '../../plugins/replication-webrtc/index.mjs';\r\nimport { startRemoteStorageServer } from './remote-storage-server.ts';\r\nimport {\r\n    blobToBase64String\r\n} from '../../plugins/core/index.mjs';\r\nimport { fileURLToPath } from 'node:url';\r\nconst __filename = fileURLToPath(import.meta.url);\r\nconst __dirname = path.dirname(__filename);\r\n\r\nexport const TEST_STATIC_FILE_SERVER_PORT = 18001;\r\nexport function startTestServers() {\r\n    const staticFilesPath = path.join(\r\n        __dirname,\r\n        '../../',\r\n        'docs-src',\r\n        'static',\r\n        'files'\r\n    );\r\n    console.log('staticFilesPath: ' + staticFilesPath);\r\n\r\n    // we need one graphql server so the browser can sync to it\r\n    GraphQLServer.spawn([], 18000);\r\n    startSignalingServerSimplePeer({\r\n        port: 18006\r\n    });\r\n    startRemoteStorageServer(18007);\r\n\r\n    /**\r\n     * we need to serve some static files\r\n     * to run tests for attachments\r\n     */\r\n    const app = express();\r\n    app.use(cors());\r\n    app.get('/', (_req: any, res: any) => {\r\n        res.send('Hello World!');\r\n    });\r\n    app.use('/files', express.static(staticFilesPath));\r\n    app.get('/base64/:filename', async (req: any, res: any) => {\r\n        const filename = req.params.filename;\r\n        const filePath = path.join(\r\n            staticFilesPath,\r\n            filename\r\n        );\r\n        const buffer = fs.readFileSync(filePath);\r\n        const blob = new Blob([buffer]);\r\n        const base64String = await blobToBase64String(blob);\r\n        res.set('Content-Type', 'text/html');\r\n        res.send(base64String);\r\n    });\r\n    app.listen(TEST_STATIC_FILE_SERVER_PORT, () => console.log(`Server listening on port: ${TEST_STATIC_FILE_SERVER_PORT}`));\r\n}\r\n"],"mappings":"AAAA,OAAOA,IAAI,MAAM,WAAW;AAC5B,OAAOC,EAAE,MAAM,SAAS;AACxB,OAAOC,OAAO,MAAM,SAAS;AAC7B,OAAOC,IAAI,MAAM,MAAM;AAEvB,OAAO,KAAKC,aAAa,MAAM,qBAAqB;AACpD,SAASC,8BAA8B,QAAQ,4CAA4C;AAC3F,SAASC,wBAAwB,QAAQ,4BAA4B;AACrE,SACIC,kBAAkB,QACf,8BAA8B;AACrC,SAASC,aAAa,QAAQ,UAAU;AACxC,IAAMC,UAAU,GAAGD,aAAa,CAACE,MAAM,CAACC,IAAI,CAACC,GAAG,CAAC;AACjD,IAAMC,SAAS,GAAGb,IAAI,CAACc,OAAO,CAACL,UAAU,CAAC;AAE1C,OAAO,IAAMM,4BAA4B,GAAG,KAAK;AACjD,OAAO,SAASC,gBAAgBA,CAAA,EAAG;EAC/B,IAAMC,eAAe,GAAGjB,IAAI,CAACkB,IAAI,CAC7BL,SAAS,EACT,QAAQ,EACR,UAAU,EACV,QAAQ,EACR,OACJ,CAAC;EACDM,OAAO,CAACC,GAAG,CAAC,mBAAmB,GAAGH,eAAe,CAAC;;EAElD;EACAb,aAAa,CAACiB,KAAK,CAAC,EAAE,EAAE,KAAK,CAAC;EAC9BhB,8BAA8B,CAAC;IAC3BiB,IAAI,EAAE;EACV,CAAC,CAAC;EACFhB,wBAAwB,CAAC,KAAK,CAAC;;EAE/B;AACJ;AACA;AACA;EACI,IAAMiB,GAAG,GAAGrB,OAAO,CAAC,CAAC;EACrBqB,GAAG,CAACC,GAAG,CAACrB,IAAI,CAAC,CAAC,CAAC;EACfoB,GAAG,CAACE,GAAG,CAAC,GAAG,EAAE,CAACC,IAAS,EAAEC,GAAQ,KAAK;IAClCA,GAAG,CAACC,IAAI,CAAC,cAAc,CAAC;EAC5B,CAAC,CAAC;EACFL,GAAG,CAACC,GAAG,CAAC,QAAQ,EAAEtB,OAAO,CAAC2B,MAAM,CAACZ,eAAe,CAAC,CAAC;EAClDM,GAAG,CAACE,GAAG,CAAC,mBAAmB,EAAE,OAAOK,GAAQ,EAAEH,GAAQ,KAAK;IACvD,IAAMI,QAAQ,GAAGD,GAAG,CAACE,MAAM,CAACD,QAAQ;IACpC,IAAME,QAAQ,GAAGjC,IAAI,CAACkB,IAAI,CACtBD,eAAe,EACfc,QACJ,CAAC;IACD,IAAMG,MAAM,GAAGjC,EAAE,CAACkC,YAAY,CAACF,QAAQ,CAAC;IACxC,IAAMG,IAAI,GAAG,IAAIC,IAAI,CAAC,CAACH,MAAM,CAAC,CAAC;IAC/B,IAAMI,YAAY,GAAG,MAAM/B,kBAAkB,CAAC6B,IAAI,CAAC;IACnDT,GAAG,CAACY,GAAG,CAAC,cAAc,EAAE,WAAW,CAAC;IACpCZ,GAAG,CAACC,IAAI,CAACU,YAAY,CAAC;EAC1B,CAAC,CAAC;EACFf,GAAG,CAACiB,MAAM,CAACzB,4BAA4B,EAAE,MAAMI,OAAO,CAACC,GAAG,gCAA8BL,4BAA8B,CAAC,CAAC;AAC5H"}